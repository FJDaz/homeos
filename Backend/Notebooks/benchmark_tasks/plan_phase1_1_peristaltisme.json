{
  "task_id": "phase1-1-peristaltisme",
  "description": "Phase 1.1 Péristaltisme : Vérifier et corriger la chaîne IR → Arbitrage → Genome. S'assurer que (1) ir_inventaire.json absent est géré gracieusement, (2) arbitrage forms et validate mettent à jour distillation_entries et genome, (3) studio.html affiche les fragments HTMX dans les bonnes zones.",
  "steps": [
    {
      "id": "step_1",
      "description": "Dans Backend/Prod/api.py : Quand ir_inventaire.json est absent, GET /studio/arbitrage/forms ne doit pas retourner 404 (qui casse HTMX). À la place : retourner un fragment HTML avec un message explicite : 'Fichier ir_inventaire.json introuvable. Exécutez : aetherflow sullivan ir-md-to-json (ou générez le genome d'abord).' avec classe Tailwind (p-4 bg-amber-50 border border-amber-200 rounded text-amber-800). Idem pour GET /studio/ir.json : si fichier absent, retourner JSON avec structure { \"organes\": [], \"_error\": \"ir_inventaire.json absent\" } au lieu de 404, pour que les appels HTMX ne cassent pas. Modifier get_studio_arbitrage_forms et get_studio_ir_json.",
      "type": "refactoring",
      "complexity": 0.3,
      "estimated_tokens": 800,
      "dependencies": [],
      "validation_criteria": [
        "GET /studio/arbitrage/forms retourne du HTML (pas 404) quand ir_inventaire.json absent",
        "GET /studio/ir.json retourne du JSON (pas 404) quand ir_inventaire.json absent",
        "Message explicite affiché pour guider l'utilisateur"
      ],
      "context": {
        "language": "python",
        "framework": "fastapi",
        "files": ["Backend/Prod/api.py"],
        "input_files": ["Backend/Prod/api.py"]
      }
    },
    {
      "id": "step_2",
      "description": "Dans Backend/Prod/api.py : Vérifier que post_studio_validate appelle correctement apply_distillation_to_genome après _save_distillation_entries. S'assurer que genome_path existe et que apply_distillation_to_genome reçoit les bons chemins. Si genome n'existe pas : générer via generate_genome() avant d'appeler apply_distillation_to_genome, ou créer un genome minimal. Ajouter un log de succès après la mise à jour. Ne pas modifier la logique de distillation_entries.",
      "type": "refactoring",
      "complexity": 0.3,
      "estimated_tokens": 600,
      "dependencies": [],
      "validation_criteria": [
        "apply_distillation_to_genome est appelé après chaque validation",
        "Genome absent : génération ou fallback minimal avant distillation",
        "Log de confirmation après mise à jour genome"
      ],
      "context": {
        "language": "python",
        "framework": "fastapi",
        "files": ["Backend/Prod/api.py"],
        "input_files": ["Backend/Prod/api.py", "Backend/Prod/core/distillation_to_genome.py"]
      }
    },
    {
      "id": "step_3",
      "description": "Dans Backend/Prod/templates/studio.html : Vérifier que les zones HTMX (revue-content, arbitrage-forms, distillation-entries, genome-summary) ont les bons hx-get, hx-target, hx-swap. S'assurer que le layout Triptyque (Revue | Arbitrage | Distillation) affiche correctement les fragments. Si un div utilise hx-get vers une route qui peut retourner 404, ajouter hx-swap-oob ou un fallback pour éviter une zone vide. Corriger tout id ou target manquant.",
      "type": "refactoring",
      "complexity": 0.4,
      "estimated_tokens": 1200,
      "dependencies": ["step_1"],
      "validation_criteria": [
        "Toutes les zones HTMX ont hx-get, hx-target, hx-swap cohérents",
        "Layout Triptyque visible (Revue, Arbitrage, Distillation)",
        "Pas de 404 cassant l'affichage"
      ],
      "context": {
        "language": "html",
        "framework": "htmx",
        "files": ["Backend/Prod/templates/studio.html"],
        "input_files": ["Backend/Prod/templates/studio.html"]
      }
    }
  ],
  "metadata": {
    "created_at": "2026-02-02T12:00:00Z",
    "claude_version": "claude-code",
    "project_context": "Phase 1.1 Péristaltisme - Chaîne IR > Arbitrage > Genome. Parcours UX Sullivan."
  }
}
